<script>
const sheetURL = "https://script.google.com/macros/s/AKfycbyafST_5SK6xObxx-FlJp69KfWJ27XDSWLTv5zaAhEyDIbT_0xm-Go2KNLYayYEZZ0r/exec";

function submitSelection() {
  const repCode = document.getElementById("repName").value;
  const repName = document.getElementById("repName").options[document.getElementById("repName").selectedIndex].text;
  const checkboxes = document.querySelectorAll("#clientList input:checked");
  const batch = document.getElementById("batchName").value;
  const notes = document.getElementById("notes").value;

  const clients = [];
  checkboxes.forEach(cb => {
    const [code, name, city, region] = cb.value.split("|");
    clients.push({ code, name, city, region });
  });

  const payload = {
    repCode,
    repName,
    batchName: batch,
    notes,
    clients: JSON.stringify(clients)
  };

  fetch(sheetURL, {
    method: "POST",
    body: new URLSearchParams(payload)
  })
  .then(res => res.text())
  .then(msg => {
    alert(msg);
    document.querySelectorAll("#clientList input:checked").forEach(cb => cb.checked = false);
    document.getElementById("notes").value = "";
    document.getElementById("batchName").value = "";
  });
}
</script>